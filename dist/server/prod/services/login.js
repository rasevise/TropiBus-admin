"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var db = require("../db/pg");
var jwt = require("jsonwebtoken");
var checkCredentials = 'SELECT admin_id FROM administrator WHERE admin_username=$1 and admin_password=$2';
function login(app) {
    var token = jwt.sign({ token: 'tropitoken' }, 'tropi');
    var admin;
    app.post("/login/authenticate", function (req, res) {
        console.log('inside server: ' + req.body.username);
        db.query(checkCredentials, [req.body.username, req.body.password], function (err, result) {
            if (err) {
                console.error(err);
                res.send('Error' + err);
            }
            else {
                if (result.rows.length === 0) {
                    res.status(400).send({
                        message: 'Incorrect Credentials'
                    });
                }
                else {
                    admin = result.rows[0];
                    res.json({ admin: admin, token: token });
                }
            }
        });
    });
}
exports.login = login;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZpY2VzL2xvZ2luLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsNkJBQStCO0FBQy9CLGtDQUFvQztBQUVwQyxJQUFJLGdCQUFnQixHQUFFLGtGQUFrRixDQUFDO0FBRXpHLGVBQXNCLEdBQXdCO0lBRTlDLElBQUksS0FBSyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFDLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDdEQsSUFBSSxLQUFLLENBQUM7SUFFVixHQUFHLENBQUMsSUFBSSxDQUFDLHFCQUFxQixFQUFFLFVBQUMsR0FBTyxFQUFFLEdBQU87UUFDN0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3JELEVBQUUsQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLEVBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLFVBQVMsR0FBTyxFQUFFLE1BQVU7WUFDNUYsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDTixPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNuQixHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUMsQ0FBQztZQUM1QixDQUFDO1lBQUEsSUFBSSxDQUFDLENBQUM7Z0JBQ0gsRUFBRSxDQUFBLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLEtBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDeEIsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7d0JBQ25CLE9BQU8sRUFBRSx1QkFBdUI7cUJBQ2pDLENBQUMsQ0FBQztnQkFDUCxDQUFDO2dCQUFBLElBQUksQ0FBQyxDQUFDO29CQUNILEtBQUssR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUN2QixHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUMsS0FBSyxPQUFBLEVBQUUsS0FBSyxPQUFBLEVBQUMsQ0FBQyxDQUFDO2dCQUM3QixDQUFDO1lBQ0wsQ0FBQztRQUNELENBQUMsQ0FBQyxDQUFDO0lBRVAsQ0FBQyxDQUFDLENBQUM7QUFDSCxDQUFDO0FBeEJELHNCQXdCQyIsImZpbGUiOiJzZXJ2aWNlcy9sb2dpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgKiBhcyBkYiBmcm9tICcuLi9kYi9wZyc7XG5pbXBvcnQgKiBhcyBqd3QgZnJvbSAnanNvbndlYnRva2VuJztcblxudmFyIGNoZWNrQ3JlZGVudGlhbHM9ICdTRUxFQ1QgYWRtaW5faWQgRlJPTSBhZG1pbmlzdHJhdG9yIFdIRVJFIGFkbWluX3VzZXJuYW1lPSQxIGFuZCBhZG1pbl9wYXNzd29yZD0kMic7XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2dpbihhcHA6IGV4cHJlc3MuQXBwbGljYXRpb24pIHtcbi8vIHNpZ24gd2l0aCBkZWZhdWx0IChITUFDIFNIQTI1NilcbnZhciB0b2tlbiA9IGp3dC5zaWduKHsgdG9rZW46ICd0cm9waXRva2VuJ30sICd0cm9waScpO1xudmFyIGFkbWluO1xuLy9NZXRob2QgdG8gdmFsaWRhdGUgTG9naW4gaW5mbyB3aXRoIGRiXG5hcHAucG9zdChgL2xvZ2luL2F1dGhlbnRpY2F0ZWAsIChyZXE6YW55LCByZXM6YW55KSA9PiB7XG4gICAgY29uc29sZS5sb2coJ2luc2lkZSBzZXJ2ZXI6ICcgKyByZXEuYm9keS51c2VybmFtZSk7XG4gIGRiLnF1ZXJ5KGNoZWNrQ3JlZGVudGlhbHMsW3JlcS5ib2R5LnVzZXJuYW1lLCByZXEuYm9keS5wYXNzd29yZF0gLGZ1bmN0aW9uKGVycjphbnksIHJlc3VsdDphbnkpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgcmVzLnNlbmQoJ0Vycm9yJyArIGVycik7XG4gICAgfWVsc2Uge1xuICAgICAgICBpZihyZXN1bHQucm93cy5sZW5ndGg9PT0wKSB7XG4gICAgICAgICAgICByZXMuc3RhdHVzKDQwMCkuc2VuZCh7XG4gICAgICAgICAgICAgIG1lc3NhZ2U6ICdJbmNvcnJlY3QgQ3JlZGVudGlhbHMnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfWVsc2Uge1xuICAgICAgICAgICAgYWRtaW4gPSByZXN1bHQucm93c1swXTtcbiAgICAgICAgICAgIHJlcy5qc29uKHthZG1pbiwgdG9rZW59KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB9KTtcblxufSk7XG59XG4iXX0=
