"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var db = require("../db/pg");
var jwt = require("jsonwebtoken");
var checkCredentials = 'SELECT admin_id FROM administrator WHERE admin_username=$1 and admin_password=$2';
function login(app) {
    var token = jwt.sign({ token: 'tropitoken' }, 'tropi');
    var admin;
    app.post("/login/authenticate", function (req, res) {
        db.query(checkCredentials, [req.body.username, req.body.password], function (err, result) {
            if (err) {
                console.error(err);
                res.send('Error' + err);
            }
            else {
                if (result.rows.length === 0) {
                    res.status(400).send({
                        message: 'Incorrect Credentials'
                    });
                }
                else {
                    admin = result.rows[0].admin_id;
                    console.log(admin);
                    res.json({ admin: admin, token: token });
                }
            }
        });
    });
}
exports.login = login;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZpY2VzL2xvZ2luLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsNkJBQStCO0FBQy9CLGtDQUFvQztBQUVwQyxJQUFJLGdCQUFnQixHQUFFLGtGQUFrRixDQUFDO0FBRXpHLGVBQXNCLEdBQXdCO0lBRTlDLElBQUksS0FBSyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFDLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDdEQsSUFBSSxLQUFLLENBQUM7SUFFVixHQUFHLENBQUMsSUFBSSxDQUFDLHFCQUFxQixFQUFFLFVBQUMsR0FBTyxFQUFFLEdBQU87UUFDL0MsRUFBRSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsRUFBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsVUFBQyxHQUFPLEVBQUUsTUFBVTtZQUNwRixFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUNOLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ25CLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxHQUFHLEdBQUcsQ0FBQyxDQUFDO1lBQzVCLENBQUM7WUFBQSxJQUFJLENBQUMsQ0FBQztnQkFDSCxFQUFFLENBQUEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sS0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUN4QixHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQzt3QkFDbkIsT0FBTyxFQUFFLHVCQUF1QjtxQkFDakMsQ0FBQyxDQUFDO2dCQUNQLENBQUM7Z0JBQUEsSUFBSSxDQUFDLENBQUM7b0JBQ0gsS0FBSyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDO29CQUNoQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUNuQixHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUMsS0FBSyxPQUFBLEVBQUUsS0FBSyxPQUFBLEVBQUMsQ0FBQyxDQUFDO2dCQUM3QixDQUFDO1lBQ0wsQ0FBQztRQUNELENBQUMsQ0FBQyxDQUFDO0lBRVAsQ0FBQyxDQUFDLENBQUM7QUFDSCxDQUFDO0FBeEJELHNCQXdCQyIsImZpbGUiOiJzZXJ2aWNlcy9sb2dpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XHJcbmltcG9ydCAqIGFzIGRiIGZyb20gJy4uL2RiL3BnJztcclxuaW1wb3J0ICogYXMgand0IGZyb20gJ2pzb253ZWJ0b2tlbic7XHJcblxyXG52YXIgY2hlY2tDcmVkZW50aWFscz0gJ1NFTEVDVCBhZG1pbl9pZCBGUk9NIGFkbWluaXN0cmF0b3IgV0hFUkUgYWRtaW5fdXNlcm5hbWU9JDEgYW5kIGFkbWluX3Bhc3N3b3JkPSQyJztcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBsb2dpbihhcHA6IGV4cHJlc3MuQXBwbGljYXRpb24pIHtcclxuLy8gc2lnbiB3aXRoIGRlZmF1bHQgKEhNQUMgU0hBMjU2KVxyXG52YXIgdG9rZW4gPSBqd3Quc2lnbih7IHRva2VuOiAndHJvcGl0b2tlbid9LCAndHJvcGknKTtcclxudmFyIGFkbWluO1xyXG4vL01ldGhvZCB0byB2YWxpZGF0ZSBMb2dpbiBpbmZvIHdpdGggZGJcclxuYXBwLnBvc3QoYC9sb2dpbi9hdXRoZW50aWNhdGVgLCAocmVxOmFueSwgcmVzOmFueSkgPT4ge1xyXG4gIGRiLnF1ZXJ5KGNoZWNrQ3JlZGVudGlhbHMsW3JlcS5ib2R5LnVzZXJuYW1lLCByZXEuYm9keS5wYXNzd29yZF0gLChlcnI6YW55LCByZXN1bHQ6YW55KSA9PiB7XHJcbiAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICAgIHJlcy5zZW5kKCdFcnJvcicgKyBlcnIpO1xyXG4gICAgfWVsc2Uge1xyXG4gICAgICAgIGlmKHJlc3VsdC5yb3dzLmxlbmd0aD09PTApIHtcclxuICAgICAgICAgICAgcmVzLnN0YXR1cyg0MDApLnNlbmQoe1xyXG4gICAgICAgICAgICAgIG1lc3NhZ2U6ICdJbmNvcnJlY3QgQ3JlZGVudGlhbHMnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1lbHNlIHtcclxuICAgICAgICAgICAgYWRtaW4gPSByZXN1bHQucm93c1swXS5hZG1pbl9pZDtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYWRtaW4pO1xyXG4gICAgICAgICAgICByZXMuanNvbih7YWRtaW4sIHRva2VufSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgfSk7XHJcblxyXG59KTtcclxufVxyXG4iXX0=
