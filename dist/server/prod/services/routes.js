"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var db = require("../db/pg");
var getAllRoutes = 'SELECT * FROM Route NATURAL JOIN routepath';
var getRoute = 'SELECT * FROM route NATURAL JOIN routepath WHERE route_id = $1';
var updateRoute = 'UPDATE Route SET route_name=$1, route_description=$2, route_area=$3 WHERE route_id=$4';
var getBusLocation = 'SELECT gps_latitude, gps_longitude, bus_name FROM bus NATURAL JOIN gps WHERE bus_status=\'Active\'';
function routes(app) {
    var _routesURL = '/routes';
    app.get(_routesURL, function (req, res, next) {
        console.log('inside routes get');
        res.contentType('application/json');
        db.query(getAllRoutes, null, function (err, result) {
            if (err) {
                console.error(err);
                res.send('Error ' + err);
            }
            else {
                res.json(result.rows);
            }
        });
    });
    app.get(_routesURL + '/getRoute', function (req, res, next) {
        res.contentType('application/json');
        db.query(getRoute, [req.query.r_id], function (err, result) {
            if (err) {
                console.error(err);
                res.send('Error ' + err);
            }
            else {
                res.json(result.rows);
            }
        });
    });
    app.put(_routesURL + '/updateRoute', function (req, res, next) {
        db.query(updateRoute, [req.body.route_name, req.body.route_description, req.body.route_area, req.body.route_id], function (err, result) {
            if (err) {
                console.error(err);
                res.send('Error ' + err);
            }
            else {
                db.query(getAllRoutes, null, function (err, result) {
                    if (err) {
                        console.error(err);
                        res.send('Error ' + err);
                    }
                    else {
                        res.json(result.rows);
                    }
                });
            }
        });
    });
    app.get(_routesURL + '/getBusLocation', function (req, res, next) {
        res.contentType('application/json');
        db.query(getBusLocation, null, function (err, result) {
            if (err) {
                res.send('Error ' + err);
            }
            else {
                console.error(result.rows);
                res.json(result.rows);
            }
        });
    });
}
exports.routes = routes;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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Q0FBQzt3QkFBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUMsQ0FBQztvQkFDL0MsQ0FBQztvQkFBQSxJQUFJLENBQUMsQ0FBQzt3QkFDTCxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztvQkFDeEIsQ0FBQztnQkFDSCxDQUFDLENBQUMsQ0FBQztZQUNMLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsR0FBRyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEdBQUcsaUJBQWlCLEVBQUUsVUFBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUk7UUFDckQsR0FBRyxDQUFDLFdBQVcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBQ3BDLEVBQUUsQ0FBQyxLQUFLLENBQUMsY0FBYyxFQUFFLElBQUksRUFBRSxVQUFDLEdBQU8sRUFBRSxNQUFVO1lBQ2pELEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ04sR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLENBQUM7WUFDN0IsQ0FBQztZQUFBLElBQUksQ0FBQyxDQUFDO2dCQUNMLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUMzQixHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN4QixDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILENBQUM7QUF0REQsd0JBc0RDIiwiZmlsZSI6InNlcnZpY2VzL3JvdXRlcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgKiBhcyBkYiBmcm9tICcuLi9kYi9wZyc7XG5cbnZhciBnZXRBbGxSb3V0ZXMgPSAnU0VMRUNUICogRlJPTSBSb3V0ZSBOQVRVUkFMIEpPSU4gcm91dGVwYXRoJztcbnZhciBnZXRSb3V0ZSA9ICdTRUxFQ1QgKiBGUk9NIHJvdXRlIE5BVFVSQUwgSk9JTiByb3V0ZXBhdGggV0hFUkUgcm91dGVfaWQgPSAkMSc7XG52YXIgdXBkYXRlUm91dGUgPSAnVVBEQVRFIFJvdXRlIFNFVCByb3V0ZV9uYW1lPSQxLCByb3V0ZV9kZXNjcmlwdGlvbj0kMiwgcm91dGVfYXJlYT0kMyBXSEVSRSByb3V0ZV9pZD0kNCc7XG52YXIgZ2V0QnVzTG9jYXRpb24gPSAnU0VMRUNUIGdwc19sYXRpdHVkZSwgZ3BzX2xvbmdpdHVkZSwgYnVzX25hbWUgRlJPTSBidXMgTkFUVVJBTCBKT0lOIGdwcyBXSEVSRSBidXNfc3RhdHVzPVxcJ0FjdGl2ZVxcJyc7XG5cbmV4cG9ydCBmdW5jdGlvbiByb3V0ZXMoYXBwOiBleHByZXNzLkFwcGxpY2F0aW9uKSB7XG5cbmxldCBfcm91dGVzVVJMID0gJy9yb3V0ZXMnO1xuYXBwLmdldChfcm91dGVzVVJMLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICBjb25zb2xlLmxvZygnaW5zaWRlIHJvdXRlcyBnZXQnKTtcbiAgICByZXMuY29udGVudFR5cGUoJ2FwcGxpY2F0aW9uL2pzb24nKTtcbiAgICBkYi5xdWVyeShnZXRBbGxSb3V0ZXMsIG51bGwsIChlcnI6YW55LCByZXN1bHQ6YW55KSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsgcmVzLnNlbmQoJ0Vycm9yICcgKyBlcnIpO1xuICAgICAgICAgICAgfWVsc2Uge1xuICAgICAgICAgICAgcmVzLmpzb24ocmVzdWx0LnJvd3MpO1xuICAgICAgICAgICAgfVxuICAgIH0pO1xufSk7XG5cbmFwcC5nZXQoX3JvdXRlc1VSTCArICcvZ2V0Um91dGUnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgcmVzLmNvbnRlbnRUeXBlKCdhcHBsaWNhdGlvbi9qc29uJyk7XG4gIGRiLnF1ZXJ5KGdldFJvdXRlLCBbcmVxLnF1ZXJ5LnJfaWRdLCAoZXJyOmFueSwgcmVzdWx0OmFueSkgPT4ge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsgcmVzLnNlbmQoJ0Vycm9yICcgKyBlcnIpO1xuICAgIH1lbHNlIHtcbiAgICByZXMuanNvbihyZXN1bHQucm93cyk7XG4gICAgfVxuICB9KTtcbn0pO1xuXG5hcHAucHV0KF9yb3V0ZXNVUkwgKyAnL3VwZGF0ZVJvdXRlJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIGRiLnF1ZXJ5KHVwZGF0ZVJvdXRlLFtyZXEuYm9keS5yb3V0ZV9uYW1lLCByZXEuYm9keS5yb3V0ZV9kZXNjcmlwdGlvbixyZXEuYm9keS5yb3V0ZV9hcmVhLCByZXEuYm9keS5yb3V0ZV9pZF0sIChlcnI6YW55LCByZXN1bHQ6YW55KSA9PiB7XG4gICAgaWYgKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpOyByZXMuc2VuZCgnRXJyb3IgJyArIGVycik7XG4gICAgfWVsc2Uge1xuICAgICAgZGIucXVlcnkoZ2V0QWxsUm91dGVzLCBudWxsLCAoZXJyOmFueSwgcmVzdWx0OmFueSkgPT4ge1xuICAgICAgICBpZihlcnIpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7IHJlcy5zZW5kKCdFcnJvciAnICsgZXJyKTtcbiAgICAgICAgfWVsc2Uge1xuICAgICAgICAgIHJlcy5qc29uKHJlc3VsdC5yb3dzKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbn0pO1xuXG5hcHAuZ2V0KF9yb3V0ZXNVUkwgKyAnL2dldEJ1c0xvY2F0aW9uJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIHJlcy5jb250ZW50VHlwZSgnYXBwbGljYXRpb24vanNvbicpO1xuICBkYi5xdWVyeShnZXRCdXNMb2NhdGlvbiwgbnVsbCwgKGVycjphbnksIHJlc3VsdDphbnkpID0+IHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICAgIHJlcy5zZW5kKCdFcnJvciAnICsgZXJyKTtcbiAgICB9ZWxzZSB7XG4gICAgICBjb25zb2xlLmVycm9yKHJlc3VsdC5yb3dzKTtcbiAgICAgIHJlcy5qc29uKHJlc3VsdC5yb3dzKTtcbiAgICB9XG4gIH0pO1xufSk7XG5cbn1cbiJdfQ==
