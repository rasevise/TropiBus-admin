"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var db = require("../db/pg");
function buses(app) {
    var _busesURL = '/buses';
    app.get(_busesURL, function (req, res, next) {
        console.log('getting buses from server: ');
        res.contentType('application/json');
        db.query('SELECT * FROM Bus NATURAL LEFT JOIN Driver ORDER BY bus_status', null, function (err, results) {
            if (err) {
                return console.error('error running query', err);
            }
            res.json(results.rows);
        });
    });
    app.post(_busesURL + '/addBus', function (req, res, next) {
        console.log('Create a bus');
        var id = 0;
        var status;
        db.query('INSERT INTO GPS(gps_latitude, gps_longitude) VALUES(0,0) RETURNING gps_id', null, function (err, result, res) {
            if (err) {
                return console.error('error running query', err);
            }
            else {
                console.log('Result:', result);
                id = result.rows[0].gps_id;
                status = 'inactive';
                console.log('GPS ID', id);
                db.query('INSERT INTO Bus( bus_name, gps_id, bus_status, route_id) VALUES ($1,$2, $3,$4) RETURNING bus_id', [req.body.name, id, req.body.status, req.body.routeid], function (err, result1) {
                    if (err) {
                        console.error(err);
                        res.send('Error ' + err);
                    }
                    else {
                        console.log('entre a meter driver', result1);
                        var b_id = result1.rows[0].bus_id;
                        db.query('UPDATE driver SET bus_id=$1 WHERE driver_id=$2', [b_id, req.body.driverid], function (err, result) {
                            {
                                res.send(result1);
                            }
                        });
                    }
                });
            }
        });
    });
    app.put(_busesURL + '/updateBus', function (req, res, next) {
        console.log('edit id:' + req.body.id);
        db.query('UPDATE Bus SET bus_name=$2, bus_status=$3, route_id=$4 WHERE bus_id=$1 RETURNING bus_id', [req.body.id, req.body.name, req.body.status, req.body.routeid], function (err, result) {
            if (err) {
                return console.error('error running query', err);
            }
            else {
                db.query('UPDATE driver SET bus_id=$1 WHERE driver_id=$2', [null, req.body.olddriverid], function (err, result1) {
                    if (err) {
                        return console.error('error running query', err);
                    }
                    else {
                        var b_id = result.rows[0].bus_id;
                        db.query('UPDATE driver SET bus_id=$1 WHERE driver_id=$2', [b_id, req.body.driverid], function (err, result) {
                            {
                                res.send(result);
                            }
                        });
                    }
                });
            }
        });
    });
    app.delete(_busesURL + '/deleteBus', function (req, res, next) {
        console.log('id:' + req.query.id);
        db.query('UPDATE driver SET bus_id=Null WHERE bus_id=$1', [req.query.id], function (err, result) {
            if (err) {
                return console.error('error running query', err);
            }
            else {
                db.query('DELETE FROM Bus WHERE bus_id=$1 RETURNING gps_id', [req.query.id], function (err, result1) {
                    if (err) {
                        return console.error('error running query', err);
                    }
                    else {
                        db.query('DELETE FROM gps WHERE gps_id=$1', [result1.rows[0].gps_id], function (err, result2) {
                            if (err) {
                                return console.error('error running query', err);
                            }
                            res.send(result2);
                        });
                    }
                });
            }
        });
    });
}
exports.buses = buses;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QyxDQUFDLENBQUMsTUFBTSxDQUFDLEVBQUUsVUFBQyxHQUFPLEVBQUUsT0FBVzs0QkFDeEYsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztnQ0FDUixNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLENBQUMsQ0FBQzs0QkFDbkQsQ0FBQzs0QkFDRCxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO3dCQUNwQixDQUFDLENBQUMsQ0FBQztvQkFDTCxDQUFDO2dCQUNILENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxDQUFDO0FBL0ZELHNCQStGQyIsImZpbGUiOiJzZXJ2aWNlcy9idXNlcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgKiBhcyBkYiBmcm9tICcuLi9kYi9wZyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBidXNlcyhhcHA6IGV4cHJlc3MuQXBwbGljYXRpb24pIHtcblxubGV0IF9idXNlc1VSTCA9ICcvYnVzZXMnO1xuXG5hcHAuZ2V0KF9idXNlc1VSTCwgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgY29uc29sZS5sb2coJ2dldHRpbmcgYnVzZXMgZnJvbSBzZXJ2ZXI6ICcpO1xuICAgIHJlcy5jb250ZW50VHlwZSgnYXBwbGljYXRpb24vanNvbicpO1xuICAgIGRiLnF1ZXJ5KCdTRUxFQ1QgKiBGUk9NIEJ1cyBOQVRVUkFMIExFRlQgSk9JTiBEcml2ZXIgT1JERVIgQlkgYnVzX3N0YXR1cycsIG51bGwsICAoZXJyOmFueSwgcmVzdWx0czphbnkpID0+IHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICByZXR1cm4gY29uc29sZS5lcnJvcignZXJyb3IgcnVubmluZyBxdWVyeScsIGVycik7XG4gICAgICB9XG4gICAgICByZXMuanNvbihyZXN1bHRzLnJvd3MpO1xuICAgIH0pO1xufSk7XG5cblxuYXBwLnBvc3QoX2J1c2VzVVJMICsgJy9hZGRCdXMnLCAocmVxLCByZXMsIG5leHQpID0+IHtcblxuICAgIGNvbnNvbGUubG9nKCdDcmVhdGUgYSBidXMnKTtcbiAgICB2YXIgaWQgPSAwO1xuICAgIHZhciBzdGF0dXM7XG5cbiAgICBkYi5xdWVyeSgnSU5TRVJUIElOVE8gR1BTKGdwc19sYXRpdHVkZSwgZ3BzX2xvbmdpdHVkZSkgVkFMVUVTKDAsMCkgUkVUVVJOSU5HIGdwc19pZCcsIG51bGwsIChlcnI6YW55LCByZXN1bHQ6YW55LCByZXM6YW55KSA9PiB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoJ2Vycm9yIHJ1bm5pbmcgcXVlcnknLCBlcnIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKCdSZXN1bHQ6JywgcmVzdWx0KTtcbiAgICAgIGlkID0gcmVzdWx0LnJvd3NbMF0uZ3BzX2lkO1xuICAgICAgc3RhdHVzID0gJ2luYWN0aXZlJztcbiAgICAgIGNvbnNvbGUubG9nKCdHUFMgSUQnICwgaWQpO1xuICAgICAgZGIucXVlcnkoJ0lOU0VSVCBJTlRPIEJ1cyggYnVzX25hbWUsIGdwc19pZCwgYnVzX3N0YXR1cywgcm91dGVfaWQpIFZBTFVFUyAoJDEsJDIsICQzLCQ0KSBSRVRVUk5JTkcgYnVzX2lkJyxbIHJlcS5ib2R5Lm5hbWUsIGlkLCByZXEuYm9keS5zdGF0dXMsIHJlcS5ib2R5LnJvdXRlaWRdLCAoZXJyOmFueSwgcmVzdWx0MTphbnkpID0+IHtcbiAgICAgICAgaWYoZXJyKXtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7IHJlcy5zZW5kKCdFcnJvciAnICsgZXJyKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgY29uc29sZS5sb2coJ2VudHJlIGEgbWV0ZXIgZHJpdmVyJyxyZXN1bHQxKTtcbiAgICAgICAgICB2YXIgYl9pZCA9IHJlc3VsdDEucm93c1swXS5idXNfaWQ7XG4gICAgICAgICAgZGIucXVlcnkoJ1VQREFURSBkcml2ZXIgU0VUIGJ1c19pZD0kMSBXSEVSRSBkcml2ZXJfaWQ9JDInLFtiX2lkLHJlcS5ib2R5LmRyaXZlcmlkXSwgKGVycjphbnksIHJlc3VsdDphbnkpID0+IHtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgcmVzLnNlbmQocmVzdWx0MSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG59KTtcblxuXG5hcHAucHV0KF9idXNlc1VSTCArICcvdXBkYXRlQnVzJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG5cbiAgICBjb25zb2xlLmxvZygnZWRpdCBpZDonICsgcmVxLmJvZHkuaWQpO1xuICAgIGRiLnF1ZXJ5KCdVUERBVEUgQnVzIFNFVCBidXNfbmFtZT0kMiwgYnVzX3N0YXR1cz0kMywgcm91dGVfaWQ9JDQgV0hFUkUgYnVzX2lkPSQxIFJFVFVSTklORyBidXNfaWQnLCBbIHJlcS5ib2R5LmlkLHJlcS5ib2R5Lm5hbWUsIHJlcS5ib2R5LnN0YXR1cywgcmVxLmJvZHkucm91dGVpZF0sIChlcnI6YW55LCByZXN1bHQ6YW55KSA9PiB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIHJldHVybiBjb25zb2xlLmVycm9yKCdlcnJvciBydW5uaW5nIHF1ZXJ5JywgZXJyKTtcbiAgICAgIH1lbHNle1xuICAgICAgICBkYi5xdWVyeSgnVVBEQVRFIGRyaXZlciBTRVQgYnVzX2lkPSQxIFdIRVJFIGRyaXZlcl9pZD0kMicsW251bGwsIHJlcS5ib2R5Lm9sZGRyaXZlcmlkXSwgKGVycjphbnksIHJlc3VsdDE6YW55KSA9PiB7XG4gICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoJ2Vycm9yIHJ1bm5pbmcgcXVlcnknLCBlcnIpO1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgdmFyIGJfaWQgPSByZXN1bHQucm93c1swXS5idXNfaWQ7XG4gICAgICAgICAgICBkYi5xdWVyeSgnVVBEQVRFIGRyaXZlciBTRVQgYnVzX2lkPSQxIFdIRVJFIGRyaXZlcl9pZD0kMicsW2JfaWQscmVxLmJvZHkuZHJpdmVyaWRdLCAoZXJyOmFueSwgcmVzdWx0OmFueSkgPT4ge1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcmVzLnNlbmQocmVzdWx0KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cblxuYXBwLmRlbGV0ZShfYnVzZXNVUkwgKyAnL2RlbGV0ZUJ1cycsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuXG4gIGNvbnNvbGUubG9nKCdpZDonICsgcmVxLnF1ZXJ5LmlkKVxuICBkYi5xdWVyeSgnVVBEQVRFIGRyaXZlciBTRVQgYnVzX2lkPU51bGwgV0hFUkUgYnVzX2lkPSQxJyxbcmVxLnF1ZXJ5LmlkXSwgKGVycjphbnksIHJlc3VsdDphbnkpID0+IHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICByZXR1cm4gY29uc29sZS5lcnJvcignZXJyb3IgcnVubmluZyBxdWVyeScsIGVycik7XG4gICAgfWVsc2V7XG4gICAgICBkYi5xdWVyeSgnREVMRVRFIEZST00gQnVzIFdIRVJFIGJ1c19pZD0kMSBSRVRVUk5JTkcgZ3BzX2lkJyxbcmVxLnF1ZXJ5LmlkXSwgKGVycjphbnksIHJlc3VsdDE6YW55KSA9PiB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICByZXR1cm4gY29uc29sZS5lcnJvcignZXJyb3IgcnVubmluZyBxdWVyeScsIGVycik7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIGRiLnF1ZXJ5KCdERUxFVEUgRlJPTSBncHMgV0hFUkUgZ3BzX2lkPSQxJyxbcmVzdWx0MS5yb3dzWzBdLmdwc19pZF0sIChlcnI6YW55LCByZXN1bHQyOmFueSkgPT4ge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICByZXR1cm4gY29uc29sZS5lcnJvcignZXJyb3IgcnVubmluZyBxdWVyeScsIGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXMuc2VuZChyZXN1bHQyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbn0pO1xuXG59XG4iXX0=
