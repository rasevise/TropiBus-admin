"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var db = require("../db/pg");
function buses(app) {
    var _busesURL = '/buses';
    app.get(_busesURL, function (req, res, next) {
        console.log('getting buses from server: ');
        res.contentType('application/json');
        db.query('SELECT * FROM Bus NATURAL LEFT JOIN Driver ORDER BY bus_status', null, function (err, results) {
            if (err) {
                console.error(err);
                res.send('Error ' + err);
            }
            else {
                res.json(results.rows);
            }
        });
    });
    app.post(_busesURL + '/addBus', function (req, res, next) {
        console.log('Create a bus');
        var id = 0;
        var status;
        db.query('INSERT INTO GPS(gps_latitude, gps_longitude) VALUES(0,0) RETURNING gps_id', null, function (err, res1) {
            if (err) {
                console.error(err);
                res1.send('Error ' + err);
            }
            else {
                console.log('Result:', res);
                id = res1.rows[0].gps_id;
                status = 'inactive';
                console.log('GPS ID', id);
                db.query('INSERT INTO Bus( bus_name, gps_id, bus_status, route_id) VALUES ($1,$2, $3,$4) RETURNING bus_id', [req.body.name, id, req.body.status, req.body.routeid], function (err, result1) {
                    if (err) {
                        console.error(err);
                        res.send('Error ' + err);
                    }
                    else {
                        console.log('entre a meter driver', result1);
                        var b_id = result1.rows[0].bus_id;
                        db.query('UPDATE driver SET bus_id=$1 WHERE driver_id=$2', [b_id, req.body.driverid], function (err, result2) {
                            {
                                res.send(result1);
                            }
                        });
                    }
                });
            }
        });
    });
    app.put(_busesURL + '/updateBus', function (req, res, next) {
        console.log('edit id:' + req.body.id);
        db.query('UPDATE Bus SET bus_name=$2, bus_status=$3, route_id=$4 WHERE bus_id=$1 RETURNING bus_id', [req.body.id, req.body.name, req.body.status, req.body.routeid], function (err, result) {
            if (err) {
                console.error(err);
                res.send('Error ' + err);
            }
            else {
                db.query('UPDATE driver SET bus_id=$1 WHERE driver_id=$2', [null, req.body.olddriverid], function (err, result1) {
                    if (err) {
                        console.error(err);
                        res.send('Error ' + err);
                    }
                    else {
                        var b_id = result.rows[0].bus_id;
                        db.query('UPDATE driver SET bus_id=$1 WHERE driver_id=$2', [b_id, req.body.driverid], function (err, result) {
                            {
                                res.send(result);
                            }
                        });
                    }
                });
            }
        });
    });
    app.delete(_busesURL + '/deleteBus', function (req, res, next) {
        console.log('id:' + req.query.id);
        db.query('UPDATE driver SET bus_id=Null WHERE bus_id=$1', [req.query.id], function (err, result) {
            if (err) {
                console.error(err);
                res.send('Error ' + err);
            }
            else {
                db.query('DELETE FROM Bus WHERE bus_id=$1 RETURNING gps_id', [req.query.id], function (err, result1) {
                    if (err) {
                        console.error(err);
                        res.send('Error ' + err);
                    }
                    else {
                        db.query('DELETE FROM gps WHERE gps_id=$1', [result1.rows[0].gps_id], function (err, result2) {
                            if (err) {
                                console.error(err);
                                res.send('Error ' + err);
                                ;
                            }
                            res.send(result2);
                        });
                    }
                });
            }
        });
    });
}
exports.buses = buses;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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Q0FBQyxDQUFDO3dCQUNQLE9BQU8sQ0FBQyxLQUFLLENBQUUsR0FBRyxDQUFDLENBQUM7d0JBQ25CLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxDQUFDO29CQUM3QixDQUFDO29CQUFBLElBQUksQ0FBQSxDQUFDO3dCQUNKLEVBQUUsQ0FBQyxLQUFLLENBQUMsaUNBQWlDLEVBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxFQUFFLFVBQUMsR0FBTyxFQUFFLE9BQVc7NEJBQ3hGLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0NBQ1gsT0FBTyxDQUFDLEtBQUssQ0FBRSxHQUFHLENBQUMsQ0FBQztnQ0FDbkIsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLENBQUM7Z0NBQUEsQ0FBQzs0QkFDMUIsQ0FBQzs0QkFDRCxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO3dCQUNwQixDQUFDLENBQUMsQ0FBQztvQkFDTCxDQUFDO2dCQUNILENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxDQUFDO0FBeEdELHNCQXdHQyIsImZpbGUiOiJzZXJ2aWNlcy9idXNlcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XHJcbmltcG9ydCAqIGFzIGRiIGZyb20gJy4uL2RiL3BnJztcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBidXNlcyhhcHA6IGV4cHJlc3MuQXBwbGljYXRpb24pIHtcclxuXHJcbmxldCBfYnVzZXNVUkwgPSAnL2J1c2VzJztcclxuXHJcbmFwcC5nZXQoX2J1c2VzVVJMLCAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICAgIGNvbnNvbGUubG9nKCdnZXR0aW5nIGJ1c2VzIGZyb20gc2VydmVyOiAnKTtcclxuICAgIHJlcy5jb250ZW50VHlwZSgnYXBwbGljYXRpb24vanNvbicpO1xyXG4gICAgZGIucXVlcnkoJ1NFTEVDVCAqIEZST00gQnVzIE5BVFVSQUwgTEVGVCBKT0lOIERyaXZlciBPUkRFUiBCWSBidXNfc3RhdHVzJywgbnVsbCwgIChlcnI6YW55LCByZXN1bHRzOmFueSkgPT4ge1xyXG4gICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICAgcmVzLnNlbmQoJ0Vycm9yICcgKyBlcnIpO1xyXG4gICAgICB9IGVsc2V7XHJcbiAgICAgIHJlcy5qc29uKHJlc3VsdHMucm93cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG59KTtcclxuXHJcblxyXG5hcHAucG9zdChfYnVzZXNVUkwgKyAnL2FkZEJ1cycsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG5cclxuICAgIGNvbnNvbGUubG9nKCdDcmVhdGUgYSBidXMnKTtcclxuICAgIHZhciBpZCA9IDA7XHJcbiAgICB2YXIgc3RhdHVzO1xyXG5cclxuICAgIGRiLnF1ZXJ5KCdJTlNFUlQgSU5UTyBHUFMoZ3BzX2xhdGl0dWRlLCBncHNfbG9uZ2l0dWRlKSBWQUxVRVMoMCwwKSBSRVRVUk5JTkcgZ3BzX2lkJywgbnVsbCwgKGVycjphbnksIHJlczE6YW55KSA9PiB7XHJcbiAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgICBjb25zb2xlLmVycm9yKCBlcnIpO1xyXG4gICAgICAgICAgICByZXMxLnNlbmQoJ0Vycm9yICcgKyBlcnIpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zb2xlLmxvZygnUmVzdWx0OicsIHJlcyk7XHJcbiAgICAgIGlkID0gcmVzMS5yb3dzWzBdLmdwc19pZDtcclxuICAgICAgc3RhdHVzID0gJ2luYWN0aXZlJztcclxuICAgICAgY29uc29sZS5sb2coJ0dQUyBJRCcgLCBpZCk7XHJcbiAgICAgIGRiLnF1ZXJ5KCdJTlNFUlQgSU5UTyBCdXMoIGJ1c19uYW1lLCBncHNfaWQsIGJ1c19zdGF0dXMsIHJvdXRlX2lkKSBWQUxVRVMgKCQxLCQyLCAkMywkNCkgUkVUVVJOSU5HIGJ1c19pZCcsWyByZXEuYm9keS5uYW1lLCBpZCwgcmVxLmJvZHkuc3RhdHVzLCByZXEuYm9keS5yb3V0ZWlkXSwgKGVycjphbnksIHJlc3VsdDE6YW55KSA9PiB7XHJcbiAgICAgICAgaWYoZXJyKXtcclxuICAgICAgICAgICBjb25zb2xlLmVycm9yKCBlcnIpO1xyXG4gICAgICAgICAgICByZXMuc2VuZCgnRXJyb3IgJyArIGVycik7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnZW50cmUgYSBtZXRlciBkcml2ZXInLHJlc3VsdDEpO1xyXG4gICAgICAgICAgdmFyIGJfaWQgPSByZXN1bHQxLnJvd3NbMF0uYnVzX2lkO1xyXG4gICAgICAgICAgZGIucXVlcnkoJ1VQREFURSBkcml2ZXIgU0VUIGJ1c19pZD0kMSBXSEVSRSBkcml2ZXJfaWQ9JDInLFtiX2lkLHJlcS5ib2R5LmRyaXZlcmlkXSwgKGVycjphbnksIHJlc3VsdDI6YW55KSA9PiB7XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICByZXMuc2VuZChyZXN1bHQxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9KTtcclxufSk7XHJcblxyXG5cclxuYXBwLnB1dChfYnVzZXNVUkwgKyAnL3VwZGF0ZUJ1cycsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG5cclxuICAgIGNvbnNvbGUubG9nKCdlZGl0IGlkOicgKyByZXEuYm9keS5pZCk7XHJcbiAgICBkYi5xdWVyeSgnVVBEQVRFIEJ1cyBTRVQgYnVzX25hbWU9JDIsIGJ1c19zdGF0dXM9JDMsIHJvdXRlX2lkPSQ0IFdIRVJFIGJ1c19pZD0kMSBSRVRVUk5JTkcgYnVzX2lkJywgWyByZXEuYm9keS5pZCxyZXEuYm9keS5uYW1lLCByZXEuYm9keS5zdGF0dXMsIHJlcS5ib2R5LnJvdXRlaWRdLCAoZXJyOmFueSwgcmVzdWx0OmFueSkgPT4ge1xyXG4gICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgICAgY29uc29sZS5lcnJvciggZXJyKTtcclxuICAgICAgICAgICAgcmVzLnNlbmQoJ0Vycm9yICcgKyBlcnIpO1xyXG4gICAgICB9ZWxzZXtcclxuICAgICAgICBkYi5xdWVyeSgnVVBEQVRFIGRyaXZlciBTRVQgYnVzX2lkPSQxIFdIRVJFIGRyaXZlcl9pZD0kMicsW251bGwsIHJlcS5ib2R5Lm9sZGRyaXZlcmlkXSwgKGVycjphbnksIHJlc3VsdDE6YW55KSA9PiB7XHJcbiAgICAgICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgICAgY29uc29sZS5lcnJvciggZXJyKTtcclxuICAgICAgICAgICAgcmVzLnNlbmQoJ0Vycm9yICcgKyBlcnIpO1xyXG4gICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHZhciBiX2lkID0gcmVzdWx0LnJvd3NbMF0uYnVzX2lkO1xyXG4gICAgICAgICAgICBkYi5xdWVyeSgnVVBEQVRFIGRyaXZlciBTRVQgYnVzX2lkPSQxIFdIRVJFIGRyaXZlcl9pZD0kMicsW2JfaWQscmVxLmJvZHkuZHJpdmVyaWRdLCAoZXJyOmFueSwgcmVzdWx0OmFueSkgPT4ge1xyXG4gICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG5cclxuYXBwLmRlbGV0ZShfYnVzZXNVUkwgKyAnL2RlbGV0ZUJ1cycsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG5cclxuICBjb25zb2xlLmxvZygnaWQ6JyArIHJlcS5xdWVyeS5pZClcclxuICBkYi5xdWVyeSgnVVBEQVRFIGRyaXZlciBTRVQgYnVzX2lkPU51bGwgV0hFUkUgYnVzX2lkPSQxJyxbcmVxLnF1ZXJ5LmlkXSwgKGVycjphbnksIHJlc3VsdDphbnkpID0+IHtcclxuICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgICBjb25zb2xlLmVycm9yKCBlcnIpO1xyXG4gICAgICAgICAgICByZXMuc2VuZCgnRXJyb3IgJyArIGVycik7XHJcbiAgICB9ZWxzZXtcclxuICAgICAgZGIucXVlcnkoJ0RFTEVURSBGUk9NIEJ1cyBXSEVSRSBidXNfaWQ9JDEgUkVUVVJOSU5HIGdwc19pZCcsW3JlcS5xdWVyeS5pZF0sIChlcnI6YW55LCByZXN1bHQxOmFueSkgPT4ge1xyXG4gICAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgICBjb25zb2xlLmVycm9yKCBlcnIpO1xyXG4gICAgICAgICAgICByZXMuc2VuZCgnRXJyb3IgJyArIGVycik7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICBkYi5xdWVyeSgnREVMRVRFIEZST00gZ3BzIFdIRVJFIGdwc19pZD0kMScsW3Jlc3VsdDEucm93c1swXS5ncHNfaWRdLCAoZXJyOmFueSwgcmVzdWx0MjphbnkpID0+IHtcclxuICAgICAgICAgICAgaWYgKGVycikge1xyXG4gICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIGVycik7XHJcbiAgICAgICAgICAgIHJlcy5zZW5kKCdFcnJvciAnICsgZXJyKTs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVzLnNlbmQocmVzdWx0Mik7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59KTtcclxuXHJcbn1cclxuIl19
