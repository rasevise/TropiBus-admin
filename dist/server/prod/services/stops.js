"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var db = require("../db/pg");
var getStopsFromRoute = 'SELECT * FROM route_stop NATURAL JOIN stop NATURAL JOIN route WHERE route_id=$1 ORDER BY stop_order';
var createStop = 'INSERT INTO Stop(stop_name,stop_description,stop_latitude,stop_longitude) VALUES($1,$2,$3,$4) RETURNING stop_id';
var asignStopToRoute = 'INSERT INTO route_stop(route_id, stop_id) VALUES($1,$2)';
var deleteStop = 'DELETE FROM Stop WHERE stop_id=$1';
var updateStop = 'UPDATE stop SET stop_name=$1, stop_description=$2 WHERE stop_id=$3';
var updateStopOrder = 'UPDATE stop SET stop_order=$1 WHERE stop_id=$2';
function stops(app) {
    var _stopsURL = '/stops';
    app.get(_stopsURL + '/getStopsFromRoute', function (req, res, next) {
        db.query(getStopsFromRoute, [req.query.r_id], function (err, result) {
            if (err) {
                console.error(err);
                res.send("Error " + err);
            }
            else {
                res.json(result.rows);
            }
        });
    });
    app.put(_stopsURL + '/updateStop', function (req, res, next) {
        var stop_name = req.body.stop_name;
        var stop_description = req.body.stop_description;
        var stop_id = req.body.s_id;
        db.query(updateStop, [stop_name, stop_description, stop_id], function (err, result) {
            if (err) {
                console.error(err);
                res.send("Error" + err);
            }
            else {
                res.json(result.rows);
            }
        });
    });
    app.put(_stopsURL + '/updateStopOrder', function (req, res, next) {
        var stops = req.body;
        console.log(stops);
        for (var i = 0; i < stops.length; i++) {
            db.query('UPDATE stop SET stop_order=$1 WHERE stop_id=$2', [i, stops[i].id], function (err, result) {
                if (err) {
                    console.error(err);
                    res.send("Error" + err);
                }
            });
        }
    });
    app.post(_stopsURL + '/createStop', function (req, res, next) {
        var stop_name = req.body.stop_name;
        var stop_description = req.body.stop_description;
        var stop_latitude = req.body.stop_latitude;
        var stop_longitude = req.body.stop_longitude;
        var routeID = req.body.r_id;
        db.query(createStop, [stop_name, stop_description, stop_latitude, stop_longitude], function (err, result) {
            var stopID = result.rows[0].stop_id;
            console.log("Stop ID: " + stopID + " Route ID: " + routeID);
            if (err) {
                console.error(err);
                res.send("Error " + err);
            }
            db.query(asignStopToRoute, [routeID, stopID], function (err, result) {
                if (err) {
                    console.error(err);
                    res.send("Error " + err);
                }
                else {
                    res.send(result);
                }
            });
        });
    });
    app.delete(_stopsURL + '/deleteStop', function (req, res, next) {
        var r_id = req.query.r_id;
        db.query(deleteStop, [req.query.stop_id], function (err, result) {
            if (err) {
                console.error(err);
                res.send("Error " + err);
            }
            else {
                res.send(result);
            }
        });
    });
}
exports.stops = stops;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZpY2VzL3N0b3BzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsNkJBQStCO0FBRS9CLElBQUksaUJBQWlCLEdBQUcscUdBQXFHLENBQUE7QUFDN0gsSUFBSSxVQUFVLEdBQUcsaUhBQWlILENBQUE7QUFDbEksSUFBSSxnQkFBZ0IsR0FBRyx5REFBeUQsQ0FBQTtBQUNoRixJQUFJLFVBQVUsR0FBRyxtQ0FBbUMsQ0FBQTtBQUNwRCxJQUFJLFVBQVUsR0FBRyxvRUFBb0UsQ0FBQTtBQUNyRixJQUFJLGVBQWUsR0FBRyxnREFBZ0QsQ0FBQTtBQUV0RSxlQUFzQixHQUF3QjtJQUM1QyxJQUFJLFNBQVMsR0FBRyxRQUFRLENBQUM7SUFPM0IsR0FBRyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEdBQUcsb0JBQW9CLEVBQUUsVUFBUyxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUk7UUFHN0QsRUFBRSxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsRUFBQyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsVUFBUyxHQUFPLEVBQUUsTUFBVTtZQUNyRSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FDSixDQUFDO2dCQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLENBQUM7WUFBQyxDQUFDO1lBQ3JELElBQUksQ0FBQSxDQUFDO2dCQUNMLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3RCLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsR0FBRyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEdBQUcsYUFBYSxFQUFFLFVBQVUsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJO1FBQ3ZELElBQUksU0FBUyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQ25DLElBQUksZ0JBQWdCLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQztRQUNqRCxJQUFJLE9BQU8sR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztRQUM1QixFQUFFLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBQyxDQUFDLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRSxPQUFPLENBQUMsRUFBRSxVQUFTLEdBQU8sRUFBRSxNQUFVO1lBQ3BGLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFBLENBQUM7Z0JBQ0wsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUMsQ0FBQztZQUNoRCxDQUFDO1lBQ0QsSUFBSSxDQUFDLENBQUM7Z0JBQ0YsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDMUIsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFFSCxHQUFHLENBQUMsR0FBRyxDQUFDLFNBQVMsR0FBRyxrQkFBa0IsRUFBRSxVQUFVLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSTtRQUM1RCxJQUFJLEtBQUssR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDO1FBQ3JCLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbkIsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDcEMsRUFBRSxDQUFDLEtBQUssQ0FBQyxnREFBZ0QsRUFBQyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsVUFBUyxHQUFPLEVBQUUsTUFBVTtnQkFDcEcsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUEsQ0FBQztvQkFDTCxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxHQUFHLEdBQUcsQ0FBQyxDQUFDO2dCQUNoRCxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUM7UUFDUCxDQUFDO0lBRUwsQ0FBQyxDQUFDLENBQUM7SUFFSCxHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxhQUFhLEVBQUUsVUFBUyxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUk7UUFDdkQsSUFBSSxTQUFTLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7UUFDbkMsSUFBSSxnQkFBZ0IsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDO1FBQ2pELElBQUksYUFBYSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDO1FBQzNDLElBQUksY0FBYyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDO1FBQzdDLElBQUksT0FBTyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQzVCLEVBQUUsQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFDLENBQUMsU0FBUyxFQUFFLGdCQUFnQixFQUFFLGFBQWEsRUFBRSxjQUFjLENBQUMsRUFBRSxVQUFTLEdBQU8sRUFBRSxNQUFVO1lBQzFHLElBQUksTUFBTSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQ3BDLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxHQUFHLE1BQU0sR0FBRyxhQUFhLEdBQUcsT0FBTyxDQUFDLENBQUE7WUFDM0QsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUEsQ0FBQztnQkFDTCxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNuQixHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUMsQ0FBQztZQUM3QixDQUFDO1lBQ0QsRUFBRSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsRUFBRSxVQUFTLEdBQU8sRUFBRSxNQUFVO2dCQUMxRSxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsQ0FBQSxDQUFDO29CQUNKLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQ25CLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxDQUFDO2dCQUM3QixDQUFDO2dCQUNELElBQUksQ0FBQSxDQUFDO29CQUNELEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ3JCLENBQUM7WUFDRCxDQUFDLENBQUMsQ0FBQztRQUNQLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFFSCxHQUFHLENBQUMsTUFBTSxDQUFDLFNBQVMsR0FBRyxhQUFhLEVBQUUsVUFBVSxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUk7UUFDMUQsSUFBSSxJQUFJLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7UUFDMUIsRUFBRSxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUMsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxFQUFFLFVBQVMsR0FBTyxFQUFFLE1BQVU7WUFDakUsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUEsQ0FBQztnQkFDTCxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxDQUFDO1lBQ2pELENBQUM7WUFDRCxJQUFJLENBQUMsQ0FBQztnQkFDRixHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ3JCLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBRUgsQ0FBQztBQXBGRCxzQkFvRkMiLCJmaWxlIjoic2VydmljZXMvc3RvcHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBleHByZXNzIGZyb20gJ2V4cHJlc3MnO1xyXG5pbXBvcnQgKiBhcyBkYiBmcm9tICcuLi9kYi9wZyc7XHJcblxyXG52YXIgZ2V0U3RvcHNGcm9tUm91dGUgPSAnU0VMRUNUICogRlJPTSByb3V0ZV9zdG9wIE5BVFVSQUwgSk9JTiBzdG9wIE5BVFVSQUwgSk9JTiByb3V0ZSBXSEVSRSByb3V0ZV9pZD0kMSBPUkRFUiBCWSBzdG9wX29yZGVyJ1xyXG52YXIgY3JlYXRlU3RvcCA9ICdJTlNFUlQgSU5UTyBTdG9wKHN0b3BfbmFtZSxzdG9wX2Rlc2NyaXB0aW9uLHN0b3BfbGF0aXR1ZGUsc3RvcF9sb25naXR1ZGUpIFZBTFVFUygkMSwkMiwkMywkNCkgUkVUVVJOSU5HIHN0b3BfaWQnXHJcbnZhciBhc2lnblN0b3BUb1JvdXRlID0gJ0lOU0VSVCBJTlRPIHJvdXRlX3N0b3Aocm91dGVfaWQsIHN0b3BfaWQpIFZBTFVFUygkMSwkMiknXHJcbnZhciBkZWxldGVTdG9wID0gJ0RFTEVURSBGUk9NIFN0b3AgV0hFUkUgc3RvcF9pZD0kMSdcclxudmFyIHVwZGF0ZVN0b3AgPSAnVVBEQVRFIHN0b3AgU0VUIHN0b3BfbmFtZT0kMSwgc3RvcF9kZXNjcmlwdGlvbj0kMiBXSEVSRSBzdG9wX2lkPSQzJ1xyXG52YXIgdXBkYXRlU3RvcE9yZGVyID0gJ1VQREFURSBzdG9wIFNFVCBzdG9wX29yZGVyPSQxIFdIRVJFIHN0b3BfaWQ9JDInXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc3RvcHMoYXBwOiBleHByZXNzLkFwcGxpY2F0aW9uKSB7XHJcbiAgbGV0IF9zdG9wc1VSTCA9ICcvc3RvcHMnO1xyXG4vLyByb3V0ZXIuZ2V0KCcvJywgZnVuY3Rpb24ocmVxLCByZXMsIG5leHQpe1xyXG4vLyAgICAgcmVzLmNvbnRlbnRUeXBlKCdhcHBsaWNhdGlvbi9qc29uJyk7XHJcbi8vICAgICB2YXIgcm91dGVzSlNPTiA9IEpTT04uc3RyaW5naWZ5KHRoaXMuc3RvcHMpO1xyXG4vLyAgICAgcmVzLmpzb24odGhpcy5zdG9wcyk7XHJcbi8vIH0pO1xyXG5cclxuYXBwLmdldChfc3RvcHNVUkwgKyAnL2dldFN0b3BzRnJvbVJvdXRlJywgZnVuY3Rpb24ocmVxLCByZXMsIG5leHQpIHsvL1BhcmFtZXRlcjogUm91dGUgSURcclxuICAgIC8vIGNvbnNvbGUubG9nKCdQcmludCBhbGwgU3RvcGYgZnJvbSBhIHNwZWNpZmljIHJvdXRlJylcclxuICAgIC8vIGNvbnNvbGUubG9nKCdSb3V0ZSBJRDogJywgcmVxLnF1ZXJ5LnJfaWQpXHJcbiAgICBkYi5xdWVyeShnZXRTdG9wc0Zyb21Sb3V0ZSxbcmVxLnF1ZXJ5LnJfaWRdLCBmdW5jdGlvbihlcnI6YW55LCByZXN1bHQ6YW55KSB7XHJcbiAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgeyBjb25zb2xlLmVycm9yKGVycik7IHJlcy5zZW5kKFwiRXJyb3IgXCIgKyBlcnIpOyB9XHJcbiAgICAgICAgZWxzZXtcclxuICAgICAgICByZXMuanNvbihyZXN1bHQucm93cyk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn0pO1xyXG5cclxuYXBwLnB1dChfc3RvcHNVUkwgKyAnL3VwZGF0ZVN0b3AnLCBmdW5jdGlvbiAocmVxLCByZXMsIG5leHQpIHtcclxuICAgIHZhciBzdG9wX25hbWUgPSByZXEuYm9keS5zdG9wX25hbWU7XHJcbiAgICB2YXIgc3RvcF9kZXNjcmlwdGlvbiA9IHJlcS5ib2R5LnN0b3BfZGVzY3JpcHRpb247XHJcbiAgICB2YXIgc3RvcF9pZCA9IHJlcS5ib2R5LnNfaWQ7XHJcbiAgICBkYi5xdWVyeSh1cGRhdGVTdG9wLFtzdG9wX25hbWUgLHN0b3BfZGVzY3JpcHRpb24sIHN0b3BfaWRdICxmdW5jdGlvbihlcnI6YW55LCByZXN1bHQ6YW55KSB7XHJcbiAgICAgICAgaWYgKGVycil7IFxyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7IHJlcy5zZW5kKFwiRXJyb3JcIiArIGVycik7IFxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmVzLmpzb24ocmVzdWx0LnJvd3MpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59KTtcclxuXHJcbmFwcC5wdXQoX3N0b3BzVVJMICsgJy91cGRhdGVTdG9wT3JkZXInLCBmdW5jdGlvbiAocmVxLCByZXMsIG5leHQpIHtcclxuICAgIHZhciBzdG9wcyA9IHJlcS5ib2R5O1xyXG4gICAgY29uc29sZS5sb2coc3RvcHMpO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdG9wcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGRiLnF1ZXJ5KCdVUERBVEUgc3RvcCBTRVQgc3RvcF9vcmRlcj0kMSBXSEVSRSBzdG9wX2lkPSQyJyxbaSwgc3RvcHNbaV0uaWRdICxmdW5jdGlvbihlcnI6YW55LCByZXN1bHQ6YW55KSB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpeyBcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsgcmVzLnNlbmQoXCJFcnJvclwiICsgZXJyKTsgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIFxyXG59KTtcclxuXHJcbmFwcC5wb3N0KF9zdG9wc1VSTCArICcvY3JlYXRlU3RvcCcsIGZ1bmN0aW9uKHJlcSwgcmVzLCBuZXh0KSB7XHJcbiAgICB2YXIgc3RvcF9uYW1lID0gcmVxLmJvZHkuc3RvcF9uYW1lO1xyXG4gICAgdmFyIHN0b3BfZGVzY3JpcHRpb24gPSByZXEuYm9keS5zdG9wX2Rlc2NyaXB0aW9uO1xyXG4gICAgdmFyIHN0b3BfbGF0aXR1ZGUgPSByZXEuYm9keS5zdG9wX2xhdGl0dWRlO1xyXG4gICAgdmFyIHN0b3BfbG9uZ2l0dWRlID0gcmVxLmJvZHkuc3RvcF9sb25naXR1ZGU7XHJcbiAgICB2YXIgcm91dGVJRCA9IHJlcS5ib2R5LnJfaWQ7XHJcbiAgICBkYi5xdWVyeShjcmVhdGVTdG9wLFtzdG9wX25hbWUgLHN0b3BfZGVzY3JpcHRpb24sIHN0b3BfbGF0aXR1ZGUsIHN0b3BfbG9uZ2l0dWRlXSAsZnVuY3Rpb24oZXJyOmFueSwgcmVzdWx0OmFueSkge1xyXG4gICAgICAgIGxldCBzdG9wSUQgPSByZXN1bHQucm93c1swXS5zdG9wX2lkO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiU3RvcCBJRDogXCIgKyBzdG9wSUQgKyBcIiBSb3V0ZSBJRDogXCIgKyByb3V0ZUlEKVxyXG4gICAgICAgIGlmIChlcnIpeyBcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpOyBcclxuICAgICAgICAgICAgcmVzLnNlbmQoXCJFcnJvciBcIiArIGVycik7IFxyXG4gICAgICAgIH1cclxuICAgICAgICBkYi5xdWVyeShhc2lnblN0b3BUb1JvdXRlLCBbcm91dGVJRCwgc3RvcElEXSwgZnVuY3Rpb24oZXJyOmFueSwgcmVzdWx0OmFueSl7XHJcbiAgICAgICAgaWYoZXJyKXsgXHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsgXHJcbiAgICAgICAgICAgIHJlcy5zZW5kKFwiRXJyb3IgXCIgKyBlcnIpOyBcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgcmVzLnNlbmQocmVzdWx0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufSk7XHJcblxyXG5hcHAuZGVsZXRlKF9zdG9wc1VSTCArICcvZGVsZXRlU3RvcCcsIGZ1bmN0aW9uIChyZXEsIHJlcywgbmV4dCkge1xyXG4gICAgdmFyIHJfaWQgPSByZXEucXVlcnkucl9pZDtcclxuICAgIGRiLnF1ZXJ5KGRlbGV0ZVN0b3AsW3JlcS5xdWVyeS5zdG9wX2lkXSAsZnVuY3Rpb24oZXJyOmFueSwgcmVzdWx0OmFueSkge1xyXG4gICAgICAgIGlmIChlcnIpeyBcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpOyByZXMuc2VuZChcIkVycm9yIFwiICsgZXJyKTsgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXMuc2VuZChyZXN1bHQpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59KTtcclxuXHJcbn1cclxuIl19
