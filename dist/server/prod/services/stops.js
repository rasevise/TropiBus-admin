"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var db = require("../db/pg");
var getStopsFromRoute = 'SELECT * FROM route_stop NATURAL JOIN stop NATURAL JOIN route WHERE route_id=$1 ORDER BY stop_order';
var createStop = 'INSERT INTO Stop(stop_name,stop_description,stop_latitude,stop_longitude) VALUES($1,$2,$3,$4) RETURNING stop_id';
var asignStopToRoute = 'INSERT INTO route_stop(route_id, stop_id) VALUES($1,$2)';
var deleteStop = 'DELETE FROM Stop WHERE stop_id=$1';
var updateStop = 'UPDATE stop SET stop_name=$1, stop_description=$2, stop_latitude=$3, stop_longitude=$4 WHERE stop_id=$5';
var updateStopOrder = 'UPDATE stop SET stop_order=$1 WHERE stop_id=$2';
function stops(app) {
    var _stopsURL = '/stops';
    app.get(_stopsURL + '/getStopsFromRoute', function (req, res, next) {
        db.query(getStopsFromRoute, [req.query.r_id], function (err, result) {
            if (err) {
                console.error(err);
                res.send('Error ' + err);
            }
            else {
                res.json(result.rows);
            }
        });
    });
    app.put(_stopsURL + '/updateStop', function (req, res, next) {
        var stop_name = req.body.stop_name;
        var stop_description = req.body.stop_description;
        var stop_latitude = req.body.stop_latitude;
        var stop_longitude = req.body.stop_longitude;
        var stop_id = req.body.s_id;
        var route_id = req.body.r_id;
        db.query(updateStop, [stop_name, stop_description, stop_latitude, stop_longitude, stop_id], function (err, result) {
            if (err) {
                console.error(err);
                res.send('Error' + err);
            }
            db.query(asignStopToRoute, [route_id, stop_id], function (err, result1) {
                if (err) {
                    console.error(err);
                    res.send('Error ' + err);
                }
                else {
                    res.send(result1.rows);
                }
            });
        });
    });
    app.put(_stopsURL + '/updateStopOrder', function (req, res, next) {
        var stops = req.body;
        console.log(stops);
        for (var i = 0; i < stops.length; i++) {
            db.query('UPDATE stop SET stop_order=$1 WHERE stop_id=$2', [i, stops[i].id], function (err, result) {
                if (err) {
                    console.error(err);
                    res.send('Error' + err);
                }
            });
        }
    });
    app.post(_stopsURL + '/createStop', function (req, res, next) {
        var stop_name = req.body.stop_name;
        var stop_description = req.body.stop_description;
        var stop_latitude = req.body.stop_latitude;
        var stop_longitude = req.body.stop_longitude;
        var routeID = req.body.r_id;
        db.query(createStop, [stop_name, stop_description, stop_latitude, stop_longitude], function (err, result) {
            var stopID = result.rows[0].stop_id;
            if (err) {
                console.error(err);
                res.send('Error ' + err);
            }
            db.query(asignStopToRoute, [routeID, stopID], function (err, result) {
                if (err) {
                    console.error(err);
                    res.send('Error ' + err);
                }
                else {
                    res.send(result);
                }
            });
        });
    });
    app.delete(_stopsURL + '/deleteStop', function (req, res, next) {
        var r_id = req.query.r_id;
        db.query(deleteStop, [req.query.stop_id], function (err, result) {
            if (err) {
                console.error(err);
                res.send('Error ' + err);
            }
            else {
                res.send(result);
            }
        });
    });
}
exports.stops = stops;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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RSxNQUFVO1lBQzFELEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ04sT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUMsQ0FBQztZQUNqRCxDQUFDO1lBQUEsSUFBSSxDQUFDLENBQUM7Z0JBQ0gsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNyQixDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUVILENBQUM7QUF6RkQsc0JBeUZDIiwiZmlsZSI6InNlcnZpY2VzL3N0b3BzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZXhwcmVzcyBmcm9tICdleHByZXNzJztcclxuaW1wb3J0ICogYXMgZGIgZnJvbSAnLi4vZGIvcGcnO1xyXG5cclxudmFyIGdldFN0b3BzRnJvbVJvdXRlID0gJ1NFTEVDVCAqIEZST00gcm91dGVfc3RvcCBOQVRVUkFMIEpPSU4gc3RvcCBOQVRVUkFMIEpPSU4gcm91dGUgV0hFUkUgcm91dGVfaWQ9JDEgT1JERVIgQlkgc3RvcF9vcmRlcic7XHJcbnZhciBjcmVhdGVTdG9wID0gJ0lOU0VSVCBJTlRPIFN0b3Aoc3RvcF9uYW1lLHN0b3BfZGVzY3JpcHRpb24sc3RvcF9sYXRpdHVkZSxzdG9wX2xvbmdpdHVkZSkgVkFMVUVTKCQxLCQyLCQzLCQ0KSBSRVRVUk5JTkcgc3RvcF9pZCc7XHJcbnZhciBhc2lnblN0b3BUb1JvdXRlID0gJ0lOU0VSVCBJTlRPIHJvdXRlX3N0b3Aocm91dGVfaWQsIHN0b3BfaWQpIFZBTFVFUygkMSwkMiknO1xyXG52YXIgZGVsZXRlU3RvcCA9ICdERUxFVEUgRlJPTSBTdG9wIFdIRVJFIHN0b3BfaWQ9JDEnO1xyXG52YXIgdXBkYXRlU3RvcCA9ICdVUERBVEUgc3RvcCBTRVQgc3RvcF9uYW1lPSQxLCBzdG9wX2Rlc2NyaXB0aW9uPSQyLCBzdG9wX2xhdGl0dWRlPSQzLCBzdG9wX2xvbmdpdHVkZT0kNCBXSEVSRSBzdG9wX2lkPSQ1JztcclxudmFyIHVwZGF0ZVN0b3BPcmRlciA9ICdVUERBVEUgc3RvcCBTRVQgc3RvcF9vcmRlcj0kMSBXSEVSRSBzdG9wX2lkPSQyJztcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzdG9wcyhhcHA6IGV4cHJlc3MuQXBwbGljYXRpb24pIHtcclxuICBsZXQgX3N0b3BzVVJMID0gJy9zdG9wcyc7XHJcbi8vIHJvdXRlci5nZXQoJy8nLCAocmVxLCByZXMsIG5leHQpID0+IHtcclxuLy8gICAgIHJlcy5jb250ZW50VHlwZSgnYXBwbGljYXRpb24vanNvbicpO1xyXG4vLyAgICAgdmFyIHJvdXRlc0pTT04gPSBKU09OLnN0cmluZ2lmeSh0aGlzLnN0b3BzKTtcclxuLy8gICAgIHJlcy5qc29uKHRoaXMuc3RvcHMpO1xyXG4vLyB9KTtcclxuXHJcbmFwcC5nZXQoX3N0b3BzVVJMICsgJy9nZXRTdG9wc0Zyb21Sb3V0ZScsIChyZXEsIHJlcywgbmV4dCkgPT4gey8vUGFyYW1ldGVyOiBSb3V0ZSBJRFxyXG4gICAgLy8gY29uc29sZS5sb2coJ1ByaW50IGFsbCBTdG9wZiBmcm9tIGEgc3BlY2lmaWMgcm91dGUnKVxyXG4gICAgLy8gY29uc29sZS5sb2coJ1JvdXRlIElEOiAnLCByZXEucXVlcnkucl9pZClcclxuICAgIGRiLnF1ZXJ5KGdldFN0b3BzRnJvbVJvdXRlLFtyZXEucXVlcnkucl9pZF0sIChlcnI6YW55LCByZXN1bHQ6YW55KSA9PiB7XHJcbiAgICAgICAgaWYgKGVycikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpOyByZXMuc2VuZCgnRXJyb3IgJyArIGVycik7XHJcbiAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgIHJlcy5qc29uKHJlc3VsdC5yb3dzKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufSk7XHJcblxyXG5hcHAucHV0KF9zdG9wc1VSTCArICcvdXBkYXRlU3RvcCcsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgdmFyIHN0b3BfbmFtZSA9IHJlcS5ib2R5LnN0b3BfbmFtZTtcclxuICAgIHZhciBzdG9wX2Rlc2NyaXB0aW9uID0gcmVxLmJvZHkuc3RvcF9kZXNjcmlwdGlvbjtcclxuICAgIHZhciBzdG9wX2xhdGl0dWRlID0gcmVxLmJvZHkuc3RvcF9sYXRpdHVkZTtcclxuICAgIHZhciBzdG9wX2xvbmdpdHVkZSA9IHJlcS5ib2R5LnN0b3BfbG9uZ2l0dWRlO1xyXG4gICAgdmFyIHN0b3BfaWQgPSByZXEuYm9keS5zX2lkO1xyXG4gICAgdmFyIHJvdXRlX2lkID0gcmVxLmJvZHkucl9pZDtcclxuICAgIGRiLnF1ZXJ5KHVwZGF0ZVN0b3AsW3N0b3BfbmFtZSAsc3RvcF9kZXNjcmlwdGlvbiwgc3RvcF9sYXRpdHVkZSwgc3RvcF9sb25naXR1ZGUsIHN0b3BfaWRdICwgKGVycjphbnksIHJlc3VsdDphbnkpID0+IHtcclxuICAgICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsgcmVzLnNlbmQoJ0Vycm9yJyArIGVycik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRiLnF1ZXJ5KGFzaWduU3RvcFRvUm91dGUsIFtyb3V0ZV9pZCwgc3RvcF9pZF0sIChlcnI6YW55LCByZXN1bHQxOmFueSkgPT4ge1xyXG4gICAgICAgIGlmKGVycikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgICAgIHJlcy5zZW5kKCdFcnJvciAnICsgZXJyKTtcclxuICAgICAgICB9ZWxzZSB7XHJcbiAgICAgICAgICAgIHJlcy5zZW5kKHJlc3VsdDEucm93cyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0pO1xyXG5cclxuYXBwLnB1dChfc3RvcHNVUkwgKyAnL3VwZGF0ZVN0b3BPcmRlcicsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgdmFyIHN0b3BzID0gcmVxLmJvZHk7XHJcbiAgICBjb25zb2xlLmxvZyhzdG9wcyk7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0b3BzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgZGIucXVlcnkoJ1VQREFURSBzdG9wIFNFVCBzdG9wX29yZGVyPSQxIFdIRVJFIHN0b3BfaWQ9JDInLFtpLCBzdG9wc1tpXS5pZF0gLCAoZXJyOmFueSwgcmVzdWx0OmFueSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7IHJlcy5zZW5kKCdFcnJvcicgKyBlcnIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG59KTtcclxuXHJcbmFwcC5wb3N0KF9zdG9wc1VSTCArICcvY3JlYXRlU3RvcCcsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgdmFyIHN0b3BfbmFtZSA9IHJlcS5ib2R5LnN0b3BfbmFtZTtcclxuICAgIHZhciBzdG9wX2Rlc2NyaXB0aW9uID0gcmVxLmJvZHkuc3RvcF9kZXNjcmlwdGlvbjtcclxuICAgIHZhciBzdG9wX2xhdGl0dWRlID0gcmVxLmJvZHkuc3RvcF9sYXRpdHVkZTtcclxuICAgIHZhciBzdG9wX2xvbmdpdHVkZSA9IHJlcS5ib2R5LnN0b3BfbG9uZ2l0dWRlO1xyXG4gICAgdmFyIHJvdXRlSUQgPSByZXEuYm9keS5yX2lkO1xyXG4gICAgZGIucXVlcnkoY3JlYXRlU3RvcCxbc3RvcF9uYW1lICxzdG9wX2Rlc2NyaXB0aW9uLCBzdG9wX2xhdGl0dWRlLCBzdG9wX2xvbmdpdHVkZV0gLCAoZXJyOmFueSwgcmVzdWx0OmFueSkgPT4ge1xyXG4gICAgICAgIGxldCBzdG9wSUQgPSByZXN1bHQucm93c1swXS5zdG9wX2lkO1xyXG4gICAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgICByZXMuc2VuZCgnRXJyb3IgJyArIGVycik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRiLnF1ZXJ5KGFzaWduU3RvcFRvUm91dGUsIFtyb3V0ZUlELCBzdG9wSURdLCAoZXJyOmFueSwgcmVzdWx0OmFueSkgPT4ge1xyXG4gICAgICAgIGlmKGVycikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgICAgIHJlcy5zZW5kKCdFcnJvciAnICsgZXJyKTtcclxuICAgICAgICB9ZWxzZSB7XHJcbiAgICAgICAgICAgIHJlcy5zZW5kKHJlc3VsdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0pO1xyXG5cclxuYXBwLmRlbGV0ZShfc3RvcHNVUkwgKyAnL2RlbGV0ZVN0b3AnLCAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICAgIHZhciByX2lkID0gcmVxLnF1ZXJ5LnJfaWQ7XHJcbiAgICBkYi5xdWVyeShkZWxldGVTdG9wLFtyZXEucXVlcnkuc3RvcF9pZF0gLCAoZXJyOmFueSwgcmVzdWx0OmFueSkgPT4ge1xyXG4gICAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpOyByZXMuc2VuZCgnRXJyb3IgJyArIGVycik7XHJcbiAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICByZXMuc2VuZChyZXN1bHQpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59KTtcclxuXHJcbn1cclxuIl19
