"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var db = require("../db/pg");
function userApp(app) {
    var _userURL = '/timuserRoutes';
    var getStopsFromRoute = 'SELECT * FROM route_stop NATURAL JOIN stop WHERE route_id=$1 ORDER BY stop_order';
    var getBusLocation = 'SELECT gps_latitude, gps_longitude, bus_name,bus_status FROM bus NATURAL JOIN gps WHERE route_id=$1';
    var getMessages = 'SELECT * FROM message';
    var getAllRoutes = 'SELECT * FROM route NATURAL JOIN routepath ORDER BY route_area';
    var getRouteStatus = 'SELECT route_id, bus_status from route NATURAL JOIN bus WHERE bus_status<>\'Inactive\'';
    app.get('/getAllRoutes', function (req, res, next) {
        console.log("entre a cojer todas las rutas");
        db.query(getAllRoutes, null, function (err, result) {
            if (err) {
                console.error(err);
                res.send("Error " + err);
            }
            else {
                db.query(getRouteStatus, null, function (err, result1) {
                    if (err) {
                        console.error(err);
                        res.send("Error " + err);
                    }
                    else {
                        console.log("coji el status de las rutas");
                        var results = result.rows;
                        var tempResults = result1.rows;
                        console.log("routes status result", tempResults);
                        if (tempResults.length == 0) {
                            for (var i = 0; i < results.length; i++) {
                                results[i].status = "Inactive";
                            }
                        }
                        else {
                            for (var i = 0; i < results.length; i++) {
                                var active = false;
                                for (var j = 0; j < tempResults.length; j++) {
                                    if (results[i].route_id == tempResults[j].route_id) {
                                        results[i].status = "Active";
                                        active = true;
                                        break;
                                    }
                                }
                                if (!active) {
                                    results[i].status = "Inactive";
                                }
                            }
                        }
                        res.json(results);
                    }
                });
            }
        });
    });
    app.get('/getStopsFromRoute', function (req, res, next) {
        console.log("cojer paradas de ruta especifica", req.query.route_id);
        db.query(getStopsFromRoute, [req.query.route_id], function (err, result) {
            if (err) {
                console.error(err);
                res.send("Error " + err);
            }
            else {
                res.json(result.rows);
            }
        });
    });
    app.get('/getBusLocation', function (req, res, next) {
        console.log("buscando localizacion de bus", req.query.route_id);
        db.query(getBusLocation, [req.query.route_id], function (err, result) {
            if (err) {
                console.error(err);
                res.send("Error " + err);
            }
            else {
                res.json(result.rows);
            }
        });
    });
    app.get('/getMessages', function (req, res, next) {
        console.log("getting messages");
        db.query(getMessages, null, function (err, result) {
            if (err) {
                console.error(err);
                res.send("Error " + err);
            }
            else {
                res.json(result.rows);
            }
        });
    });
}
exports.userApp = userApp;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZpY2VzL3RpbXVzZXJSb3V0ZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFrQkEsNkJBQStCO0FBRS9CLGlCQUF3QixHQUF3QjtJQUtoRCxJQUFNLFFBQVEsR0FBRyxnQkFBZ0IsQ0FBQztJQUNsQyxJQUFJLGlCQUFpQixHQUFHLGtGQUFrRixDQUFBO0lBQzFHLElBQUksY0FBYyxHQUFHLHFHQUFxRyxDQUFBO0lBQzFILElBQUksV0FBVyxHQUFHLHVCQUF1QixDQUFBO0lBQ3pDLElBQUksWUFBWSxHQUFHLGdFQUFnRSxDQUFBO0lBQ25GLElBQUksY0FBYyxHQUFDLHdGQUF3RixDQUFBO0lBRzNHLEdBQUcsQ0FBQyxHQUFHLENBQUMsZUFBZSxFQUFFLFVBQUMsR0FBTyxFQUFFLEdBQU8sRUFBRSxJQUFRO1FBQ2hELE9BQU8sQ0FBQyxHQUFHLENBQUMsK0JBQStCLENBQUMsQ0FBQztRQUV6QyxFQUFFLENBQUMsS0FBSyxDQUFDLFlBQVksRUFBRSxJQUFJLEVBQUUsVUFBQyxHQUFPLEVBQUUsTUFBVTtZQUU3QyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FDUCxDQUFDO2dCQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLENBQUM7WUFBQyxDQUFDO1lBQ2xELElBQUksQ0FBQSxDQUFDO2dCQUVMLEVBQUUsQ0FBQyxLQUFLLENBQUMsY0FBYyxFQUFFLElBQUksRUFBRSxVQUFDLEdBQU8sRUFBRSxPQUFXO29CQUVoRCxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FDUixDQUFDO3dCQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7d0JBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLENBQUM7b0JBQUMsQ0FBQztvQkFDakQsSUFBSSxDQUFBLENBQUM7d0JBQ0wsT0FBTyxDQUFDLEdB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QyxHQUFHLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxFQUFDLFVBQUMsR0FBTyxFQUFFLE1BQVU7WUFFOUQsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQ1AsQ0FBQztnQkFBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxDQUFDO1lBQUMsQ0FBQztZQUNsRCxJQUFJLENBQUEsQ0FBQztnQkFFTCxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN0QixDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDWCxDQUFDLENBQUMsQ0FBQztJQUdILEdBQUcsQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLFVBQUMsR0FBTyxFQUFFLEdBQU8sRUFBRSxJQUFRO1FBQy9DLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUMsQ0FBQTtRQUczQixFQUFFLENBQUMsS0FBSyxDQUFDLFdBQVcsRUFBRSxJQUFJLEVBQUUsVUFBQyxHQUFPLEVBQUUsTUFBVTtZQUU1QyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FDUCxDQUFDO2dCQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLENBQUM7WUFBQyxDQUFDO1lBQ2xELElBQUksQ0FBQSxDQUFDO2dCQUVMLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3RCLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNYLENBQUMsQ0FBQyxDQUFDO0FBRUgsQ0FBQztBQW5IRCwwQkFtSEMiLCJmaWxlIjoic2VydmljZXMvdGltdXNlclJvdXRlcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKiBcclxuICogQXV0aG9yOiBMdWlzIFRvcm9cclxuICogQ3JlYXRpb24gRGF0ZTogMy8xOC8yMDE3XHJcbiAqXHJcbiAqIERlc2NyaXB0aW9uOiBDb250YWlucyBCdXMgVHJhY2tpbmcgYXBwIHJvdXRlcyBhbmQgcXVlcmllcyBcclxuICogXHJcbiAqIFJvdXRlczpcclxuICogXHQvZ2V0QWxsUm91dGVzXHJcbiAqICAvZ2V0Um91dGUgXHJcbiAqICAvZ2V0QWxsU3RvcHMgXHJcbiAqICAvZ2V0TmVhcmVzdFN0b3AgXHJcbiAqICAvZ2V0U3RvcHNGcm9tUm91dGUgXHJcbiAqICAvZ2V0QnVzTG9jYXRpb24gXHJcbiAqICAvZ2V0TWVzc2FnZXMgXHJcbiAqICAvZ2V0QnVzZXMgXHJcbioqL1xyXG5cclxuaW1wb3J0ICogYXMgZXhwcmVzcyBmcm9tICdleHByZXNzJztcclxuaW1wb3J0ICogYXMgZGIgZnJvbSAnLi4vZGIvcGcnO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHVzZXJBcHAoYXBwOiBleHByZXNzLkFwcGxpY2F0aW9uKSB7XHJcblxyXG4vL1JvdXRlcyBxdWVyaWVzIGRlY2xhcmF0aW9uIFxyXG5cclxuXHJcbmNvbnN0IF91c2VyVVJMID0gJy90aW11c2VyUm91dGVzJztcclxudmFyIGdldFN0b3BzRnJvbVJvdXRlID0gJ1NFTEVDVCAqIEZST00gcm91dGVfc3RvcCBOQVRVUkFMIEpPSU4gc3RvcCBXSEVSRSByb3V0ZV9pZD0kMSBPUkRFUiBCWSBzdG9wX29yZGVyJyBcclxudmFyIGdldEJ1c0xvY2F0aW9uID0gJ1NFTEVDVCBncHNfbGF0aXR1ZGUsIGdwc19sb25naXR1ZGUsIGJ1c19uYW1lLGJ1c19zdGF0dXMgRlJPTSBidXMgTkFUVVJBTCBKT0lOIGdwcyBXSEVSRSByb3V0ZV9pZD0kMSdcclxudmFyIGdldE1lc3NhZ2VzID0gJ1NFTEVDVCAqIEZST00gbWVzc2FnZSdcclxudmFyIGdldEFsbFJvdXRlcyA9ICdTRUxFQ1QgKiBGUk9NIHJvdXRlIE5BVFVSQUwgSk9JTiByb3V0ZXBhdGggT1JERVIgQlkgcm91dGVfYXJlYSdcclxudmFyIGdldFJvdXRlU3RhdHVzPSdTRUxFQ1Qgcm91dGVfaWQsIGJ1c19zdGF0dXMgZnJvbSByb3V0ZSBOQVRVUkFMIEpPSU4gYnVzIFdIRVJFIGJ1c19zdGF0dXM8PlxcJ0luYWN0aXZlXFwnJ1xyXG5cclxuLy9nZXQgYWxsIHJvdXRlcyBmcm9tIGRhdGFiYXNlIGFuZCBzZW5kIHRoZW0gYmFjayBhcyByZXNwb25zZVxyXG5hcHAuZ2V0KCcvZ2V0QWxsUm91dGVzJywgKHJlcTphbnksIHJlczphbnksIG5leHQ6YW55KSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhcImVudHJlIGEgY29qZXIgdG9kYXMgbGFzIHJ1dGFzXCIpO1xyXG4gICAgICAgIC8vcnVuIHF1ZXJ5XHJcbiAgICAgICAgZGIucXVlcnkoZ2V0QWxsUm91dGVzLCBudWxsLCAoZXJyOmFueSwgcmVzdWx0OmFueSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgIHsgY29uc29sZS5lcnJvcihlcnIpOyByZXMuc2VuZChcIkVycm9yIFwiICsgZXJyKTsgfVxyXG4gICAgICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICAgICAgLy9ydW4gcXVlcnlcclxuICAgICAgICAgICAgZGIucXVlcnkoZ2V0Um91dGVTdGF0dXMsIG51bGwsIChlcnI6YW55LCByZXN1bHQxOmFueSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChlcnIpXHJcbiAgICAgICAgICAgICAgICB7IGNvbnNvbGUuZXJyb3IoZXJyKTsgcmVzLnNlbmQoXCJFcnJvciBcIiArIGVycik7IH1cclxuICAgICAgICAgICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImNvamkgZWwgc3RhdHVzIGRlIGxhcyBydXRhc1wiKVxyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdHM9cmVzdWx0LnJvd3M7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGVtcFJlc3VsdHM9cmVzdWx0MS5yb3dzO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJyb3V0ZXMgc3RhdHVzIHJlc3VsdFwiLHRlbXBSZXN1bHRzKVxyXG4gICAgICAgICAgICAgICAgLy9pZiBubyBidXNlcyBhcmUgYWN0aXZlIHNldCBzdGF0dXMgb2Ygcm91dGVzIHRvIGluYWN0aXZlXHJcbiAgICAgICAgICAgICAgICBpZih0ZW1wUmVzdWx0cy5sZW5ndGg9PTApe1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaT0wO2k8cmVzdWx0cy5sZW5ndGg7aSsrKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0c1tpXS5zdGF0dXM9XCJJbmFjdGl2ZVwiXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy9zb21lIGJ1c2VzIGFyZSBhY3RpdmUgb24gc29tZSByb3V0ZVxyXG4gICAgICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGk9MDtpPHJlc3VsdHMubGVuZ3RoO2krKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhY3RpdmU9ZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgYnVzIGhhcyBhbiBhY3RpdmUgb3IgY2hhbmdpbmcgZHJpdmVyIHN0YXR1cywgc2V0IHJvdXRlIHN0YXR1cyB0byBhY3RpdmVcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBqPTA7ajx0ZW1wUmVzdWx0cy5sZW5ndGg7aisrKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdHNbaV0ucm91dGVfaWQ9PXRlbXBSZXN1bHRzW2pdLnJvdXRlX2lkKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzW2ldLnN0YXR1cz1cIkFjdGl2ZVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlPXRydWU7IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiB0aGVyZSBpcyBubyBidXMgb24gc29tZSByb3V0ZSB3aXRoIGFjdGl2ZSBvciBjaGFuZ2luZyBkcml2ZXIgc3RhdHVzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2Fzc2lnbmVkIHJvdXRlIHN0YXR1cyB0byBpbmFjdGl2ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgaWYoIWFjdGl2ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0c1tpXS5zdGF0dXM9XCJJbmFjdGl2ZVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy9zZW5kaW5nIHJlc3VsdCBiYWNrIGFzIGpzb25cclxuICAgICAgICAgICAgICAgIHJlcy5qc29uKHJlc3VsdHMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbn0pO1xyXG5cclxuXHJcbi8vZ2V0IGFsbCBidXMgc3RvcHMgZnJvbSBzcGVjaWZpYyByb3V0ZSBhbmQgc2VuZCBpbmZvIGJhY2sgYXMgcmVzcG9uc2VcclxuYXBwLmdldCgnL2dldFN0b3BzRnJvbVJvdXRlJywgKHJlcTphbnksIHJlczphbnksIG5leHQ6YW55KSA9PiB7Ly9QYXJhbWV0ZXI6IFJvdXRlIElEXHJcbiAgICBjb25zb2xlLmxvZyhcImNvamVyIHBhcmFkYXMgZGUgcnV0YSBlc3BlY2lmaWNhXCIscmVxLnF1ZXJ5LnJvdXRlX2lkKVxyXG4gICAgLy9jb25uZXRpbmcgdG8gZGF0YWJhc2VcclxuICAgICAgICAvL3J1bm5pbmcgcXVlcnlcclxuICAgICAgICBkYi5xdWVyeShnZXRTdG9wc0Zyb21Sb3V0ZSxbcmVxLnF1ZXJ5LnJvdXRlX2lkXSwgKGVycjphbnksIHJlc3VsdDphbnkpID0+IHtcclxuXHJcbiAgICAgICAgICAgIGlmIChlcnIpXHJcbiAgICAgICAgICAgICB7IGNvbnNvbGUuZXJyb3IoZXJyKTsgcmVzLnNlbmQoXCJFcnJvciBcIiArIGVycik7IH1cclxuICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgLy9zZW5kaW5nIHJlc3BvbnNlIGJhY2sgYXMgIGpzb25cclxuICAgICAgICAgICAgcmVzLmpzb24ocmVzdWx0LnJvd3MpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbn0pO1xyXG5cclxuLy9nZXR0aW5nIGJ1cyBsb2NhdGlvbiBmcm9tIHNwZWNpZmljIHJvdXRlXHJcbmFwcC5nZXQoJy9nZXRCdXNMb2NhdGlvbicsIChyZXE6YW55LCByZXM6YW55LCBuZXh0OmFueSkgPT4ge1xyXG4gICAgY29uc29sZS5sb2coXCJidXNjYW5kbyBsb2NhbGl6YWNpb24gZGUgYnVzXCIscmVxLnF1ZXJ5LnJvdXRlX2lkKVxyXG4gICAgLy9jb25uZWN0aW5nIHRvIGRhdGFiYXNlXHJcbiAgICAgICAgLy9ydW5uaWcgcXVlcnlcclxuICAgICAgICBkYi5xdWVyeShnZXRCdXNMb2NhdGlvbiwgW3JlcS5xdWVyeS5yb3V0ZV9pZF0sKGVycjphbnksIHJlc3VsdDphbnkpID0+IHtcclxuXHJcbiAgICAgICAgICAgIGlmIChlcnIpXHJcbiAgICAgICAgICAgICB7IGNvbnNvbGUuZXJyb3IoZXJyKTsgcmVzLnNlbmQoXCJFcnJvciBcIiArIGVycik7IH1cclxuICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgLy9zZW5kaW5nIHJlc3VsdCBiYWNrIGFzIGpzb25cclxuICAgICAgICAgICAgcmVzLmpzb24ocmVzdWx0LnJvd3MpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbn0pO1xyXG5cclxuLy9nZXR0aW5nIG1lc3NhZ2VzIHBvc3RlZCBieSBhZG1pbmlzdHJhdG9yXHJcbmFwcC5nZXQoJy9nZXRNZXNzYWdlcycsIChyZXE6YW55LCByZXM6YW55LCBuZXh0OmFueSkgPT4ge1xyXG4gICAgY29uc29sZS5sb2coXCJnZXR0aW5nIG1lc3NhZ2VzXCIpXHJcbiAgICAvL2Nvbm5lY3RpbmcgdG8gZGF0YWJhc2VcclxuICAgICAgICAvL3J1biBxdWVyeVxyXG4gICAgICAgIGRiLnF1ZXJ5KGdldE1lc3NhZ2VzLCBudWxsLCAoZXJyOmFueSwgcmVzdWx0OmFueSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgIHsgY29uc29sZS5lcnJvcihlcnIpOyByZXMuc2VuZChcIkVycm9yIFwiICsgZXJyKTsgfVxyXG4gICAgICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICAvL3NlbmQgcmVzdWx0IGJhY2sgYXMganNvblxyXG4gICAgICAgICAgICByZXMuanNvbihyZXN1bHQucm93cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxufSk7XHJcblxyXG59XHJcblxyXG4iXX0=
